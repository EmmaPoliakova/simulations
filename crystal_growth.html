<!DOCTYPE html>
<html>
    <head>
        <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
        <link rel="stylesheet" type="text/css" href="style.css">
        <style>
            .column {
                float: left;
                width: 515px;
            }

            .row:after {
                content: "";
                display: table;
                clear: both;
                    }

        </style>
    </head>

    <body onload='draw()'>
      <div class="row1">
        <div class="column">
        <div>
            <canvas id='canvas' width='505' height='505'></canvas>
        </div>

        <div id=buttons>
            <button class="button" id="start" onclick="setUp()">Set Up</button>
            <button class="button" id="play" onclick="play()">Play</button>
            <button class="button" id="stop" onclick="stop()">Stop</button>
        </div>


        <div class="slidecontainer">
            <p>Temperature: <span id="temperature"></span></p>
            <input type="range" min="0" max="500" value="0" class="slider" id="myRange">

        </div>
            </div>
      </div>

<script>
    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    var size = 201;
    var square_size = 2.5;
    var dx = 0.03;
    var dy = 0.03 ;
    var dt = 0.0003 ;
    var steptau = 0.0003;
    var epsilonbar = 0.01;
    var mu = 1.0;
    var k = 4;
    var delta = 0.02;
    var anisotropy = 4.0 ;
    var alpha = 0.9;
    var gamma = 10.0;
    var teq = 1.0 ;

    var t = createArray(size,size);
    var epsilon = createArray(size,size);
    var epsilon_derivative = createArray(size,size);
    var phi = createArray(size,size);
    var grad_phi_x = createArray(size,size);
    var grad_phi_y = createArray(size,size);
    var lap_phi = createArray(size,size);
    var lap_t = createArray(size,size);
    var phinew = createArray(size,size);
    var tnew = createArray(size,size);
    var angl = createArray(size,size);
    var times = 0;


 // create n x n array
        function createArray(length) {
            var arr = new Array(length || 0),
            i = length;

            if (arguments.length > 1) {
                var args = Array.prototype.slice.call(arguments, 1);
                while(i--) arr[length-1 - i] = createArray.apply(this, args);
            }

            return arr;
        }

    function setNuclei(){
        for (var i = 0 ; i<size; i+=1){
            for (var j = 0 ; j<size; j+=1){
                phi[i][j] = 0;
                if ((i-size/2)*(i-size/2)+(j-size/2)*(j-size/2)<20)){
                phi[i][j] = 1;
                }

            }
        }
    }

    function laplace(){
        for (var i = 0 ; i<size; i+=1){
            for (var j = 0 ; j<size; j+=1){
                var jp = j+1;
                var jm = j-1;
                var ip = i+1;
                var im = i-1;

                if (im==0){
                    im = nx-1;}
                else if (ip==nx){
                    ip = 0;}

                if (jm==0){
                    jm = ny-1;}
                else if (jp==ny){
                    jp = 0;}

                grad_phi_x[i][j] = (phi[ip][j] -phi[m][j])/dx;
                grad_phi_y[i][j] = (phi[i][jp] -phi[i][jm])/dy;

                lap_phi[i][j] = (2.0*(phi[ip][j]+phi[im][j]+phi[i][jp]+ phi[i][jm]) + phi[ip][jp]+phi[im][jm]+phi[im][jp]+ ph[ip][jm] -12.0*phi[i][j])/(3.0*dx*dx);
                lap_t[i][j] = (2.0*(t[ip][j]+t[im][j]+t[i][jp]+t[i][jm]) + t[ip][jp]+t[im][jm]+t[im][jp]+t[ip][jm] -12.0*t[i][j])/(3.0*dx*dx);

                if (grad_phi_x[i][j]==0){
                    if (grad_phi_y[i][j]<0 ){
                        angl[i][j] =-0.5*pi;}
                    else if (grad_phi_y[i][j]>0 ){
                        angl[i][j] = 0.5*pi;}
                }

                if (grad_phi_x[i][j]>0){
                    if (grad_phi_y[i][j]<0){
                        angl[i][j]) = 2.0*pi + atan(grad_phi_y[i][j]/grad_phi_x[i][j]);}
                    else if (grad_phi_y[i][j]>0){
                        angl[i][j] = atan(grad_phi_y[i][j]/grad_phi_x[i][j]);}
                }

                if (grad_phi_x[i][j]<0){
                    angl[i][j] = pi +atan(grad_phi_y[i][j]/grad_phi_x[i][j]);}


                epsilon[i][j] = epsilonbar*(1.0 + delta*cos(anisotropy*(angl[i][j])));
                epsilon_derivative[i][j] = -epsilonbar*anisotropy*delta*sin(anisotropy*(angl[i][j]));

            }
        }

    }

    function evolution(){
        for (var i = 0 ; i<size; i+=1){
            for (var j = 0 ; j<size; j+=1){
                var jp = j+1;
                var jm = j-1;
                var ip = i+1;
                var im = i-1;

                if (im==0){
                    im = nx-1;}
                else if (ip==nx){
                    ip = 0;}

                if (jm==0){
                    jm = ny-1;}
                else if (jp==ny){
                    jp = 0;}

            var grad_epsilon2_x = (epsilon[ip][j]^2 -epsilon[im][j]^2)/dx;
            var grad_epsilon2_y = (epsilon[i][jp]^2 -epsilon[i][jm]^2)/dy;

            var term1 = (epsilon[i][jp] * epsilon_derivative[i][jp] * grad_phi_x[i][jp] - epsilon[i][jm] * epsilon _derivative[i][jm] * g rad_phi_x[i][jm])/dy;
            var term2 = -(epsilon[ip][j] * epsilon_derivative[ip][j] * grad_phi_y[ip][j] - epsilon[im][j] * epsilon _derivative[im][j] * g rad_phi_y[im][j])/dx;
            var term3 = grad_epsilon2_x * grad_phi_x[i][j] + grad_epsilon2_y * grad_phi_y[i][j];

            var phiold = phi[i][j];
            var m = alpha/pi * atan(gamma*(teq-t[i][j]));

            phinew[i][j] = phi[i][j] + (term1 + term2 + epsilon[i][j]*epsilon[i][j]*lap_phi[i][j] + term3 + phiold*(1.0-phiold)*(phiold-0.5+m))*dt/tau;
            tnew[i][j] = t[i][j] + lap _t[i][j]*dt + k*(phinew[i][j] -phiold);
            }
        }
    }

    function draw(){
        if (canvas.getContext) {
                var context = canvas.getContext('2d');
                context.strokeStyle='black';


                context.moveTo(square_size, canvas.width-square_size);
                context.lineTo(canvas.width-square_size, canvas.width-square_size);


                context.moveTo(canvas.width-square_size, square_size);
                context.lineTo(canvas.width-square_size, canvas.width-square_size);


                context.moveTo(square_size, square_size);
                context.lineTo(canvas.width-square_size, square_size);


                context.moveTo(square_size, square_size);
                context.lineTo(square_size,canvas.width-square_size);
                context.stroke();



    }

       function step(){
            laplace();
            evolution();
            newFrame();
       }
       function play(){
            game = setInterval(step, 0.001);
            }

       function stop(){
            clearInterval(game);
        }
    </script>
    </body>
</html>
